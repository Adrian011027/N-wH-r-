# ğŸ—ï¸ DIAGRAMA DE INTEGRACIÃ“N - ImÃ¡genes CategorÃ­as y SubcategorÃ­as

## ğŸ¯ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NAVEGADOR (Cliente)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Dashboard â†’ CategorÃ­as/SubcategorÃ­as                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  HTML (Template)                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ input[type=file] (oculto)                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ label (ğŸ“· Elegir imagen)                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ .preview-categoria/.preview-subcategoria (120x120)   â”‚ â”‚
â”‚  â”‚  â””â”€ btn-remove-preview (X rojo)                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  CSS (Estilos)                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ .file-input-wrapper                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ .file-label (azul, hover)                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ .image-preview-container (120x120)                   â”‚ â”‚
â”‚  â”‚  â””â”€ .btn-remove-preview (rojo)                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  JavaScript (LÃ³gica)                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ inputImagen.addEventListener("change")               â”‚ â”‚
â”‚  â”‚  â”œâ”€ FileReader.readAsDataURL()                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ FormData.append("imagen", file)                      â”‚ â”‚
â”‚  â”‚  â””â”€ fetch("/api/categorias/crear/", {method: "POST"})   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†“ HTTP                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LocalStorage (Tokens JWT)                                 â”‚ â”‚
â”‚  â”‚ â”œâ”€ access (30 minutos)                                    â”‚ â”‚
â”‚  â”‚ â”œâ”€ refresh (7 dÃ­as)                                       â”‚ â”‚
â”‚  â”‚ â””â”€ user_id                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ POST /api/categorias/crear/
                      Content-Type: multipart/form-data
                      Authorization: Bearer <JWT_TOKEN>
                      Body: {nombre, imagen}
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVIDOR Django                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ URLS (store/urls.py)                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ path("api/categorias/crear/", create_categoria)           â”‚ â”‚
â”‚  â”‚ path("api/categorias/actualizar/<id>/", update_categoria) â”‚ â”‚
â”‚  â”‚ path("api/subcategorias/crear/", create_subcategoria)    â”‚ â”‚
â”‚  â”‚ path("api/subcategorias/actualizar/<id>/", ...)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ VIEWS (store/views/)                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ views.py:                                                â”‚ â”‚
â”‚  â”‚ â”œâ”€ @jwt_role_required()                                   â”‚ â”‚
â”‚  â”‚ â”œâ”€ def create_categoria(request):                         â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ nombre = request.POST.get("nombre")                 â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ imagen = request.FILES.get("imagen")                â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ Categoria.objects.create(nombre, imagen)            â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€ return JSON(id, nombre, imagen_url)                â”‚ â”‚
â”‚  â”‚ â”‚                                                          â”‚ â”‚
â”‚  â”‚ â”œâ”€ def update_categoria(request, id):                     â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ if 'imagen' in request.FILES:                       â”‚ â”‚
â”‚  â”‚ â”‚  â”‚  â””â”€ categoria.imagen = request.FILES['imagen']       â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ categoria.save()                                    â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€ return JSON(...)                                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ subcategorias.py: (similar para subcategorÃ­as)            â”‚ â”‚
â”‚  â”‚ â”œâ”€ def create_subcategoria(request):                      â”‚ â”‚
â”‚  â”‚ â”œâ”€ def update_subcategoria(request, id):                  â”‚ â”‚
â”‚  â”‚ â””â”€ ...                                                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MODELOS (store/models.py)                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ class Categoria(models.Model):                            â”‚ â”‚
â”‚  â”‚     nombre = CharField(max_length=100)                    â”‚ â”‚
â”‚  â”‚     imagen = ImageField(                                  â”‚ â”‚
â”‚  â”‚         upload_to='categorias/',                          â”‚ â”‚
â”‚  â”‚         null=True,                                        â”‚ â”‚
â”‚  â”‚         blank=True                                        â”‚ â”‚
â”‚  â”‚     )                                                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ class Subcategoria(models.Model):                         â”‚ â”‚
â”‚  â”‚     nombre = CharField(max_length=100)                    â”‚ â”‚
â”‚  â”‚     categoria = ForeignKey(Categoria, ...)                â”‚ â”‚
â”‚  â”‚     imagen = ImageField(                                  â”‚ â”‚
â”‚  â”‚         upload_to='subcategorias/',                       â”‚ â”‚
â”‚  â”‚         null=True,                                        â”‚ â”‚
â”‚  â”‚         blank=True                                        â”‚ â”‚
â”‚  â”‚     )                                                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ STORAGE (FileSystem o S3)                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ LOCAL (Desarrollo):                                       â”‚ â”‚
â”‚  â”‚ â””â”€ media/                                                 â”‚ â”‚
â”‚  â”‚    â”œâ”€ categorias/                                         â”‚ â”‚
â”‚  â”‚    â”‚  â””â”€ test_categoria_12345.jpg                         â”‚ â”‚
â”‚  â”‚    â””â”€ subcategorias/                                      â”‚ â”‚
â”‚  â”‚       â””â”€ test_subcat_12345.jpg                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ S3 (ProducciÃ³n - si USE_S3=True):                        â”‚ â”‚
â”‚  â”‚ â””â”€ s3://bucket-name/media/                               â”‚ â”‚
â”‚  â”‚    â”œâ”€ categorias/                                         â”‚ â”‚
â”‚  â”‚    â””â”€ subcategorias/                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DATABASE (PostgreSQL/SQLite)                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ categorias tabla:                                         â”‚ â”‚
â”‚  â”‚ â”œâ”€ id (PK)                                                â”‚ â”‚
â”‚  â”‚ â”œâ”€ nombre                                                 â”‚ â”‚
â”‚  â”‚ â””â”€ imagen (CharField con path relativo)                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ subcategorias tabla:                                      â”‚ â”‚
â”‚  â”‚ â”œâ”€ id (PK)                                                â”‚ â”‚
â”‚  â”‚ â”œâ”€ nombre                                                 â”‚ â”‚
â”‚  â”‚ â”œâ”€ categoria_id (FK)                                      â”‚ â”‚
â”‚  â”‚ â””â”€ imagen (CharField con path relativo)                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘ HTTP 200 + JSON Response
                    {
                      "id": 42,
                      "nombre": "Test",
                      "imagen": "/media/categorias/..."
                    }
                    â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NAVEGADOR (Cliente)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ JavaScript recibe respuesta                               â”‚ â”‚
â”‚  â”‚ â”œâ”€ Toast/Alert "CategorÃ­a creada exitosamente"            â”‚ â”‚
â”‚  â”‚ â”œâ”€ cargarCategorias() se ejecuta automÃ¡ticamente          â”‚ â”‚
â”‚  â”‚ â”œâ”€ Tabla se recarga                                       â”‚ â”‚
â”‚  â”‚ â””â”€ Nueva categorÃ­a visible con imagen                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Datos: CREATE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario     â”‚
â”‚ Selecciona  â”‚
â”‚ Imagen      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript: Change Event        â”‚
â”‚ â€¢ inputImagen.addEventListener  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileReader API                  â”‚
â”‚ â€¢ readAsDataURL(file)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Canvas/Preview actualiza        â”‚
â”‚ â€¢ Muestra imagen 120x120        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario hace click "Guardar"    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript: FormData                    â”‚
â”‚ â€¢ new FormData()                        â”‚
â”‚ â€¢ append("nombre", value)               â”‚
â”‚ â€¢ append("imagen", file)                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fetch API: POST                             â”‚
â”‚ â€¢ /api/categorias/crear/                    â”‚
â”‚ â€¢ Content-Type: multipart/form-data         â”‚
â”‚ â€¢ Authorization: Bearer <JWT>               â”‚
â”‚ â€¢ Body: FormData (nombre + archivo)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
       â•‘ HTTP Request
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Django: create_categoria()             â”‚
â”‚ â€¢ Procesa request.POST (nombre)        â”‚
â”‚ â€¢ Procesa request.FILES (imagen)       â”‚
â”‚ â€¢ Valida JWT (admin only)              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Django ORM: ImageField                 â”‚
â”‚ â€¢ Guarda archivo en media/categorias/  â”‚
â”‚ â€¢ Crea registro en DB                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Respuesta JSON                         â”‚
â”‚ {                                      â”‚
â”‚   "id": 42,                           â”‚
â”‚   "nombre": "Test",                   â”‚
â”‚   "imagen": "/media/categorias/..."   â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
       â•‘ HTTP 200 Response
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript: Procesa respuesta          â”‚
â”‚ â€¢ Toast.success("Creado")              â”‚
â”‚ â€¢ cargarCategorias() reload            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tabla se actualiza                     â”‚
â”‚ â€¢ Nuevo item visible                   â”‚
â”‚ â€¢ Imagen renderizada                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ IntegraciÃ³n de Componentes

### **Frontend Stack**
```
HTML Templates (Django)
    â†“
    â”œâ”€ File Input Wrapper (oculto)
    â”œâ”€ Label Estilizada (ğŸ“·)
    â””â”€ Preview Container (vacÃ­o hasta seleccionar)
    â†“
CSS (Estilos)
    â†“
    â”œâ”€ file-input-wrapper (position relative)
    â”œâ”€ file-label (color, hover effects)
    â”œâ”€ image-preview-container (120x120)
    â””â”€ btn-remove-preview (rojo, absoluto)
    â†“
JavaScript (LÃ³gica)
    â†“
    â”œâ”€ Event Listener (change)
    â”œâ”€ FileReader (readAsDataURL)
    â”œâ”€ FormData (append imagen)
    â”œâ”€ Fetch (POST a API)
    â””â”€ DOM Update (tabla reload)
```

### **Backend Stack**
```
URLs (Django)
    â†“
    â”œâ”€ POST /api/categorias/crear/
    â”œâ”€ POST /api/categorias/actualizar/<id>/
    â”œâ”€ POST /api/subcategorias/crear/
    â””â”€ PATCH /api/subcategorias/actualizar/<id>/
    â†“
Views (Django)
    â†“
    â”œâ”€ JWT Validation (@jwt_role_required)
    â”œâ”€ request.FILES.get("imagen")
    â”œâ”€ Django Model.objects.create(imagen=file)
    â””â”€ return JsonResponse(data)
    â†“
Models (ORM)
    â†“
    â”œâ”€ Categoria.imagen = ImageField(upload_to='categorias/')
    â””â”€ Subcategoria.imagen = ImageField(upload_to='subcategorias/')
    â†“
Storage
    â†“
    â”œâ”€ Local: media/categorias/ y media/subcategorias/
    â””â”€ S3: s3://bucket/media/categorias/ (si configurado)
    â†“
Database
    â†“
    â””â”€ Almacena path relativo (ej: categorias/file_12345.jpg)
```

---

## ğŸ” Seguridad en Flujo

```
Cliente (Browser)
    â†“
    â”œâ”€ HTML5 accept="image/*" â† ValidaciÃ³n client-side
    â”œâ”€ FileReader verifica file.type â† ValidaciÃ³n JS
    â””â”€ FormData (no raw body) â† Formato seguro
    â†“
Network
    â†“
    â””â”€ HTTPS (en producciÃ³n) â† EncriptaciÃ³n
    â†“
Django
    â†“
    â”œâ”€ @jwt_role_required() â† Auth requerida
    â”œâ”€ request.FILES (seguro) â† Django valida
    â”œâ”€ ImageField.clean() â† ORM valida imagen
    â””â”€ upload_to='categorias/' â† Path seguro, no root
    â†“
Storage
    â†“
    â””â”€ Permisos 755 en media/ â† Acceso controlado
    â†“
Database
    â†“
    â””â”€ UNIQUE constraint (opcional) â† Integridad
```

---

## ğŸ“Š Relaciones Diagrama ER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CATEGORIA                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID (PK)               â†â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ NOMBRE (VARCHAR)              â”‚   â”‚
â”‚ IMAGEN (VARCHAR/PATH)         â”‚   â”‚
â”‚ CREATED_AT (DATETIME)         â”‚   â”‚
â”‚ UPDATED_AT (DATETIME)         â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                                â”‚ 1:N
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   SUBCATEGORIA      â”‚  â”‚  ARCHIVO EN DISCO    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ ID (PK)             â”‚  â”‚ media/categorias/    â”‚
        â”‚ NOMBRE              â”‚  â”‚  â”œâ”€ test_001.jpg     â”‚
        â”‚ CATEGORIA_ID (FK)   â”‚  â”‚  â”œâ”€ test_002.jpg     â”‚
        â”‚ IMAGEN (VARCHAR)    â”‚  â”‚  â””â”€ test_003.png     â”‚
        â”‚ CREATED_AT          â”‚  â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ media/subcategorias/ â”‚
                                 â”‚  â”œâ”€ sub_001.jpg      â”‚
                                 â”‚  â””â”€ sub_002.jpg      â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ConfiguraciÃ³n Requerida

```
ecommerce/settings.py:
â”œâ”€ MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
â”œâ”€ MEDIA_URL = '/media/'
â”œâ”€ DEFAULT_FILE_STORAGE = (local o S3)
â””â”€ INSTALLED_APPS = [..., 'django.contrib.staticfiles', ...]

ecommerce/urls.py:
â”œâ”€ urlpatterns += static(MEDIA_URL, document_root=MEDIA_ROOT)
â””â”€ (En desarrollo local)

.env:
â”œâ”€ USE_S3 = False (o True en prod)
â”œâ”€ AWS_ACCESS_KEY_ID = (si S3)
â””â”€ AWS_SECRET_ACCESS_KEY = (si S3)

Carpetas:
â”œâ”€ media/categorias/          (debe existir)
â”œâ”€ media/subcategorias/       (debe existir)
â””â”€ media/productos/           (ya existe)
```

---

## ğŸ”„ Ciclo de Vida de Imagen

```
1. UPLOAD
   User selecciona archivo
   â†“
2. PREVIEW
   FileReader muestra en browser
   â†“
3. ENVIO
   FormData â†’ HTTP POST
   â†“
4. PROCESAR
   Django procesa request.FILES
   â†“
5. GUARDAR
   ImageField salva en MEDIA_ROOT
   â†“
6. REGISTRAR
   Path almacenado en Database
   â†“
7. ACCEDER
   URL: /media/categorias/archivo.jpg
   â†“
8. MOSTRAR
   <img src="/media/categorias/archivo.jpg">
   â†“
9. EDITAR
   Usuario abre modal
   Imagen actual se muestra desde URL
   â†“
10. ACTUALIZAR
    Usuario selecciona nueva imagen
    Reemplaza vieja en MEDIA_ROOT
    DB actualiza ruta
```

---

## ğŸ¯ Puntos de IntegraciÃ³n Clave

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUNTO 1: HTML Template                         â”‚
â”‚  âœ“ input file con id=imagen-categoria                      â”‚
â”‚  âœ“ label con class=file-label                              â”‚
â”‚  âœ“ div con class=preview-categoria (inicialmente vacÃ­o)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUNTO 2: CSS Styling                           â”‚
â”‚  âœ“ .file-input-wrapper oculta input, posiciona label      â”‚
â”‚  âœ“ .file-label estilizado (botÃ³n azul)                     â”‚
â”‚  âœ“ .image-preview-container (120x120)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUNTO 3: JavaScript Logic                      â”‚
â”‚  âœ“ addEventListener("change") en inputImagen              â”‚
â”‚  âœ“ FileReader.readAsDataURL()                              â”‚
â”‚  âœ“ FormData.append() con imagen                            â”‚
â”‚  âœ“ fetch("/api/categorias/crear/", {method: "POST"})     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUNTO 4: Backend Endpoint                      â”‚
â”‚  âœ“ @jwt_role_required() valida auth                        â”‚
â”‚  âœ“ request.FILES.get("imagen") obtiene archivo            â”‚
â”‚  âœ“ Categoria.objects.create(imagen=file)                   â”‚
â”‚  âœ“ return JsonResponse(...)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUNTO 5: File Storage                          â”‚
â”‚  âœ“ Django ImageField guarda en MEDIA_ROOT/categorias/     â”‚
â”‚  âœ“ Retorna path relativo: categorias/file_12345.jpg       â”‚
â”‚  âœ“ URL accesible: /media/categorias/file_12345.jpg        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Checklist

```
LOCAL (Desarrollo)
â”œâ”€ [x] media/ carpeta existe
â”œâ”€ [x] media/categorias/ existe
â”œâ”€ [x] media/subcategorias/ existe
â”œâ”€ [x] MEDIA_ROOT en settings.py
â”œâ”€ [x] MEDIA_URL en settings.py
â”œâ”€ [x] urlpatterns + static(MEDIA_URL)
â””â”€ [x] TEST: Crear categorÃ­a con imagen

PRODUCCIÃ“N (Servidor)
â”œâ”€ [ ] S3 bucket creado (opcional)
â”œâ”€ [ ] AWS credentials en .env
â”œâ”€ [ ] USE_S3 = True en .env
â”œâ”€ [ ] Permisos de escritura en media/
â”œâ”€ [ ] HTTPS habilitado
â”œâ”€ [ ] CORS configurado (si aplica)
â””â”€ [ ] HTTPS para JWT tokens
```

---

**Diagrama VersiÃ³n:** 1.0
**Ãšltima ActualizaciÃ³n:** 2024
**Estado:** âœ… FINAL

