{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}Subcategor√≠as - Dashboard{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'dashboard/css/categorias/categorias.css' %}?v=2">

<div class="categorias-page">
  <!-- Header -->
  <div class="categorias-header">
    <div class="header-info">
      <h1>üìÇ Subcategor√≠as</h1>
      <p class="subtitle">Administra las subcategor√≠as para filtros avanzados</p>
    </div>
  </div>

  <!-- Estad√≠sticas -->
  <div class="categorias-stats">
    <div class="stat-card">
      <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
      </div>
      <div class="stat-info">
        <span class="stat-number" id="stat-total">0</span>
        <span class="stat-label">Total Subcategor√≠as</span>
      </div>
    </div>
  </div>

  <!-- Formulario de nueva subcategor√≠a -->
  <div class="cat-form-card">
    <div class="form-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="16"></line>
        <line x1="8" y1="12" x2="16" y2="12"></line>
      </svg>
      Nueva Subcategor√≠a
    </div>
    <form id="form-subcategoria" class="cat-form" enctype="multipart/form-data">
      <div class="form-input-group">
        <select id="categoria-select" required>
          <option value="">Seleccionar categor√≠a...</option>
        </select>
        <input type="text" id="nombre-subcategoria" placeholder="Nombre de la subcategor√≠a" required>
        <div class="file-input-wrapper">
          <input type="file" id="imagen-subcategoria" accept="image/*" class="file-input">
          <span class="file-label">üì∑ Elegir imagen</span>
        </div>
        <div id="preview-subcategoria" class="image-preview-container" style="display: none;">
          <img id="preview-img-subcategoria" src="" alt="Vista previa" class="preview-img">
          <button type="button" class="btn-remove-preview" onclick="document.getElementById('imagen-subcategoria').value=''; document.getElementById('preview-subcategoria').style.display='none';">‚úï</button>
        </div>
        <button type="submit" class="btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Agregar
        </button>
      </div>
    </form>
  </div>

  <!-- Loading state -->
  <div id="loading-state" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando subcategor√≠as...</p>
  </div>

  <!-- Grid de subcategor√≠as -->
  <div id="subcategorias-grid" class="categorias-grid" style="display: none;">
    <!-- Las tarjetas se generan por JS -->
  </div>

  <!-- Empty state -->
  <div id="empty-state" class="empty-state" style="display: none;">
    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
    </svg>
    <h3>No hay subcategor√≠as</h3>
    <p>Crea tu primera subcategor√≠a usando el formulario de arriba</p>
  </div>
</div>

<!-- Modal de edici√≥n -->
<div id="edit-modal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h3>‚úèÔ∏è Editar Subcategor√≠a</h3>
      <button class="modal-close" onclick="cerrarModal()">√ó</button>
    </div>
    <div class="modal-body">
      <form id="edit-form" enctype="multipart/form-data">
        <input type="hidden" id="edit-id">
        <div class="form-group">
          <label for="edit-categoria">Categor√≠a</label>
          <select id="edit-categoria" required>
            <option value="">Seleccionar categor√≠a...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="edit-nombre">Nombre de la subcategor√≠a</label>
          <input type="text" id="edit-nombre" required placeholder="Nombre de la subcategor√≠a">
        </div>
        <div class="form-group">
          <label for="edit-imagen">Imagen de la subcategor√≠a</label>
          <div class="file-input-wrapper">
            <input type="file" id="edit-imagen" accept="image/*" class="file-input">
            <span class="file-label">üì∑ Elegir imagen</span>
          </div>
          <small id="edit-imagen-info" style="display:none; color:#666;">Dejar vac√≠o para mantener imagen actual</small>
          <div id="preview-edit-sub" class="image-preview-container" style="display: none;">
            <img id="preview-img-edit-sub" src="" alt="Vista previa" class="preview-img">
            <button type="button" class="btn-remove-preview" onclick="document.getElementById('edit-imagen').value=''; document.getElementById('preview-edit-sub').style.display='none';">‚úï</button>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-submit">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script src="{% static 'dashboard/js/categorias/subcategorias.js' %}?v=1"></script>
{% endblock %}
