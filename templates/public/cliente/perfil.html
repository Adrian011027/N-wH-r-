{% extends 'public/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'public/cliente/css/main.css' %}">
{% endblock %}

{% block content %}
<main class="fade-in">
  <div class="profile-header">
    <h1>Mi Perfil</h1>
    <p class="subtitle">Gestiona tu informaci√≥n personal y preferencias de compra</p>
  </div>

  <!-- Mensajes de √©xito/error -->
  {% if messages %}
  <div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %}

  <form method="POST" id="profile-form" class="profile-form">
    {% csrf_token %}

    <!-- Secci√≥n: Informaci√≥n Personal -->
    <section class="form-section">
      <h2 class="section-title">
        <span class="icon">üë§</span>
        Informaci√≥n Personal
      </h2>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="nombre">Nombre Completo <span class="required">*</span></label>
          <input type="text" id="nombre" name="nombre" value="{{ cliente.nombre }}" required>
        </div>

        <div class="form-group">
          <label for="username">Nombre de Usuario <span class="required">*</span></label>
          {% if puede_cambiar_username %}
          <input type="text" id="username" name="username" value="{{ cliente.username }}" 
                 required minlength="3" pattern="[a-zA-Z0-9._]+">
          <small class="field-hint">Solo letras, n√∫meros, puntos y guiones bajos. Puedes cambiarlo 1 vez al mes.</small>
          {% else %}
          <input type="text" id="username" name="username" value="{{ cliente.username }}" 
                 required readonly class="input-readonly">
          <small class="field-hint warning">‚è≥ Podr√°s cambiar tu nombre de usuario en {{ dias_restantes }} d√≠as</small>
          {% endif %}
        </div>

        <div class="form-group">
          <label for="correo">Correo Electr√≥nico <span class="required">*</span></label>
          <input type="email" id="correo" name="correo" value="{{ cliente.correo }}" required>
        </div>

        <div class="form-group">
          <label for="telefono">Tel√©fono <span class="required">*</span></label>
          <input type="tel" id="telefono" name="telefono" value="{{ cliente.telefono }}" 
                 placeholder="3312345678" pattern="[0-9]{10}" required>
          <small class="field-hint">10 d√≠gitos sin espacios</small>
        </div>

        <div class="form-group">
          <label for="telefono_alternativo">Tel√©fono Alternativo</label>
          <input type="tel" id="telefono_alternativo" name="telefono_alternativo" 
                 value="{{ cliente.telefono_alternativo }}" placeholder="3398765432" pattern="[0-9]{10}">
        </div>
      </div>
    </section>

    <!-- Secci√≥n: Direcci√≥n de Env√≠o -->
    <section class="form-section">
      <h2 class="section-title">
        <span class="icon">üìç</span>
        Direcci√≥n de Env√≠o
      </h2>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="calle">Calle y N√∫mero <span class="required">*</span></label>
          <input type="text" id="calle" name="calle" value="{{ cliente.calle }}" 
                 placeholder="Av. Insurgentes 123" required>
        </div>

        <div class="form-group">
          <label for="colonia">Colonia <span class="required">*</span></label>
          <input type="text" id="colonia" name="colonia" value="{{ cliente.colonia }}" required>
        </div>

        <div class="form-group">
          <label for="codigo_postal">C√≥digo Postal <span class="required">*</span></label>
          <input type="text" id="codigo_postal" name="codigo_postal" 
                 value="{{ cliente.codigo_postal }}" pattern="[0-9]{5}" 
                 placeholder="44100" required>
        </div>

        <div class="form-group">
          <label for="ciudad">Ciudad <span class="required">*</span></label>
          <input type="text" id="ciudad" name="ciudad" value="{{ cliente.ciudad }}" required>
        </div>

        <div class="form-group">
          <label for="estado">Estado <span class="required">*</span></label>
          <select id="estado" name="estado" required>
            <option value="">Selecciona un estado</option>
            <option value="Aguascalientes" {% if cliente.estado == "Aguascalientes" %}selected{% endif %}>Aguascalientes</option>
            <option value="Baja California" {% if cliente.estado == "Baja California" %}selected{% endif %}>Baja California</option>
            <option value="Baja California Sur" {% if cliente.estado == "Baja California Sur" %}selected{% endif %}>Baja California Sur</option>
            <option value="Campeche" {% if cliente.estado == "Campeche" %}selected{% endif %}>Campeche</option>
            <option value="Chiapas" {% if cliente.estado == "Chiapas" %}selected{% endif %}>Chiapas</option>
            <option value="Chihuahua" {% if cliente.estado == "Chihuahua" %}selected{% endif %}>Chihuahua</option>
            <option value="Ciudad de M√©xico" {% if cliente.estado == "Ciudad de M√©xico" %}selected{% endif %}>Ciudad de M√©xico</option>
            <option value="Coahuila" {% if cliente.estado == "Coahuila" %}selected{% endif %}>Coahuila</option>
            <option value="Colima" {% if cliente.estado == "Colima" %}selected{% endif %}>Colima</option>
            <option value="Durango" {% if cliente.estado == "Durango" %}selected{% endif %}>Durango</option>
            <option value="Guanajuato" {% if cliente.estado == "Guanajuato" %}selected{% endif %}>Guanajuato</option>
            <option value="Guerrero" {% if cliente.estado == "Guerrero" %}selected{% endif %}>Guerrero</option>
            <option value="Hidalgo" {% if cliente.estado == "Hidalgo" %}selected{% endif %}>Hidalgo</option>
            <option value="Jalisco" {% if cliente.estado == "Jalisco" %}selected{% endif %}>Jalisco</option>
            <option value="M√©xico" {% if cliente.estado == "M√©xico" %}selected{% endif %}>Estado de M√©xico</option>
            <option value="Michoac√°n" {% if cliente.estado == "Michoac√°n" %}selected{% endif %}>Michoac√°n</option>
            <option value="Morelos" {% if cliente.estado == "Morelos" %}selected{% endif %}>Morelos</option>
            <option value="Nayarit" {% if cliente.estado == "Nayarit" %}selected{% endif %}>Nayarit</option>
            <option value="Nuevo Le√≥n" {% if cliente.estado == "Nuevo Le√≥n" %}selected{% endif %}>Nuevo Le√≥n</option>
            <option value="Oaxaca" {% if cliente.estado == "Oaxaca" %}selected{% endif %}>Oaxaca</option>
            <option value="Puebla" {% if cliente.estado == "Puebla" %}selected{% endif %}>Puebla</option>
            <option value="Quer√©taro" {% if cliente.estado == "Quer√©taro" %}selected{% endif %}>Quer√©taro</option>
            <option value="Quintana Roo" {% if cliente.estado == "Quintana Roo" %}selected{% endif %}>Quintana Roo</option>
            <option value="San Luis Potos√≠" {% if cliente.estado == "San Luis Potos√≠" %}selected{% endif %}>San Luis Potos√≠</option>
            <option value="Sinaloa" {% if cliente.estado == "Sinaloa" %}selected{% endif %}>Sinaloa</option>
            <option value="Sonora" {% if cliente.estado == "Sonora" %}selected{% endif %}>Sonora</option>
            <option value="Tabasco" {% if cliente.estado == "Tabasco" %}selected{% endif %}>Tabasco</option>
            <option value="Tamaulipas" {% if cliente.estado == "Tamaulipas" %}selected{% endif %}>Tamaulipas</option>
            <option value="Tlaxcala" {% if cliente.estado == "Tlaxcala" %}selected{% endif %}>Tlaxcala</option>
            <option value="Veracruz" {% if cliente.estado == "Veracruz" %}selected{% endif %}>Veracruz</option>
            <option value="Yucat√°n" {% if cliente.estado == "Yucat√°n" %}selected{% endif %}>Yucat√°n</option>
            <option value="Zacatecas" {% if cliente.estado == "Zacatecas" %}selected{% endif %}>Zacatecas</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label for="referencias">Referencias de Ubicaci√≥n</label>
          <textarea id="referencias" name="referencias" rows="2" 
                    placeholder="Ej: Entre calle 5 de Mayo y Morelos, casa color blanco">{{ cliente.referencias }}</textarea>
          <small class="field-hint">Ay√∫danos a encontrar tu domicilio m√°s f√°cil</small>
        </div>
      </div>
    </section>

    <!-- Secci√≥n: Informaci√≥n Fiscal (para mayoristas) -->
    <section class="form-section">
      <h2 class="section-title">
        <span class="icon">üßæ</span>
        Informaci√≥n Fiscal (Opcional)
      </h2>
      <p class="section-description">Completa esta secci√≥n si requieres factura o eres comprador mayorista</p>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="tipo_cliente">Tipo de Cliente</label>
          <select id="tipo_cliente" name="tipo_cliente">
            <option value="menudeo" {% if cliente.tipo_cliente == "menudeo" %}selected{% endif %}>Menudeo</option>
            <option value="mayoreo" {% if cliente.tipo_cliente == "mayoreo" %}selected{% endif %}>Mayoreo</option>
          </select>
          <small class="field-hint">Los precios mayoristas aplican desde 6 piezas</small>
        </div>

        <div class="form-group">
          <label for="rfc">RFC</label>
          <input type="text" id="rfc" name="rfc" value="{{ cliente.rfc }}" 
                 placeholder="XAXX010101000" pattern="[A-Z√ë&]{3,4}[0-9]{6}[A-Z0-9]{3}" 
                 style="text-transform: uppercase;">
        </div>

        <div class="form-group full-width">
          <label for="razon_social">Raz√≥n Social</label>
          <input type="text" id="razon_social" name="razon_social" 
                 value="{{ cliente.razon_social }}" placeholder="Nombre de tu empresa">
        </div>

        <div class="form-group full-width">
          <label for="direccion_fiscal">Direcci√≥n Fiscal</label>
          <input type="text" id="direccion_fiscal" name="direccion_fiscal" 
                 value="{{ cliente.direccion_fiscal }}" 
                 placeholder="Si es diferente a tu direcci√≥n de env√≠o">
        </div>
      </div>
    </section>

    <!-- Secci√≥n: Seguridad -->
    <section class="form-section">
      <h2 class="section-title">
        <span class="icon">üîí</span>
        Cambiar Contrase√±a
      </h2>
      <p class="section-description">Deja en blanco si no deseas cambiar tu contrase√±a</p>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="password_actual">Contrase√±a Actual</label>
          <input type="password" id="password_actual" name="password_actual" 
                 placeholder="Tu contrase√±a actual">
        </div>

        <div class="form-group">
          <label for="password_nueva">Nueva Contrase√±a</label>
          <input type="password" id="password_nueva" name="password_nueva" 
                 placeholder="M√≠nimo 8 caracteres" minlength="8">
        </div>

        <div class="form-group">
          <label for="password_confirmar">Confirmar Nueva Contrase√±a</label>
          <input type="password" id="password_confirmar" name="password_confirmar" 
                 placeholder="Repite la nueva contrase√±a">
        </div>
      </div>
    </section>

    <!-- Botones de acci√≥n -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" onclick="window.history.back()">
        Cancelar
      </button>
      <button type="submit" class="btn-primary">
        <span class="btn-icon">üíæ</span>
        Guardar Cambios
      </button>
    </div>
  </form>
</main>

<script src="{% static 'public/cliente/js/perfil.js' %}"></script>
{% endblock %}
