{% load static %}
<!-- HEADER -->
<header>
  <div class="header-left fade-in">
    <button id="btn-burger" class="burger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <span class="menu-label"></span>
    
    <!-- üîç B√∫squeda (solo m√≥vil) -->
    <button id="btn-search-mobile" class="user-icon search-mobile" aria-label="Buscar productos">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
    </button>
  </div>

  <div class="header-center">
    <a href="{% url 'index' %}">
      <img src="{% static 'images/NowHere.svg' %}" id="Logo" class="fade-in" alt="N√∂wHƒórƒì">
    </a>
  </div>

  <div class="header-right fade-in">
    <button id="btn-contacto" class="btn-contacto">Cont√°ctanos</button>

    <!-- üîç B√∫squeda (solo desktop) -->
    <button id="btn-search" class="user-icon search-desktop" aria-label="Buscar productos">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
    </button>

    <!-- ‚ù§Ô∏è Wishlist -->
    <button id="btn-wishlist-panel" class="user-icon" aria-label="Ver wishlist">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
          fill="none" stroke="currentColor" stroke-width="1.5"
          stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 21l7.8-7.8 1-1a5.5 5.5 0 0 0 0-7.8z"/>
      </svg>
      <span id="wishlist-count" class="wishlist-count" hidden>0</span>
    </button>

    <!-- üõí Carrito -->
    <button id="btn-cart-panel" class="user-icon" aria-label="Ver carrito"
            onclick='window.location.href="{% url "ver_carrito" %}"'>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M6 2l1 4h10l1-4"/>
        <path d="M3 6h18l-1.5 12.5a2 2 0 0 1-2 1.5H6.5a2 2 0 0 1-2-1.5L3 6z"/>
        <path d="M9 10v2"/>
        <path d="M15 10v2"/>
      </svg>
    </button>

    <!-- ‚ñº Ambos botones, se muestran/ocultan con JS -->
    <!-- Icono login (invitado) -->
    <button id="btn-login" class="user-icon" aria-label="Iniciar sesi√≥n" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="8" r="4"/>
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
      </svg>
    </button>

    <!-- Icono usuario (logueado) -->
    <button id="btn-user-menu" class="user-icon" aria-label="Men√∫ de usuario" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="8" r="4"/>
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
      </svg>
    </button>
  </div>
</header>

<!-- NAV MENU - Elegante con cascada -->
<nav class="nav-menu" id="nav-menu">
  <div class="nav-menu-header">
    <button class="close-menu" id="btn-close-menu" aria-label="Cerrar men√∫">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Panel Principal: G√©neros -->
  <div class="nav-panel nav-panel-main active" id="panel-main">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="{% url 'index' %}" class="nav-link">
          <span>INICIO</span>
        </a>
      </li>
      
      <!-- MUJER -->
      <li class="nav-item nav-item-expandable" data-genero="mujer">
        <button class="nav-link genero-trigger" data-genero="mujer">
          <span>Mujer</span>
          <svg class="nav-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </li>

      <!-- HOMBRE -->
      <li class="nav-item nav-item-expandable" data-genero="hombre">
        <button class="nav-link genero-trigger" data-genero="hombre">
          <span>Hombre</span>
          <svg class="nav-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </li>
    </ul>
  </div>
</nav>

<!-- Sistema de Navegaci√≥n en Cascada tipo Louis Vuitton -->
<!-- Desktop: 3 divs separados lado a lado | Mobile: Navegaci√≥n deslizante -->

<!-- Panel de Categor√≠as (Nivel 2) -->
<div class="lv-panel lv-panel-categories" id="lv-panel-categories">
  <div class="lv-panel-header">
    <button class="lv-back-btn lv-mobile-only" id="lv-back-to-main">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      <span>Volver</span>
    </button>
    <h2 class="lv-panel-title" id="lv-categories-title">Mujer</h2>
  </div>
  <div class="lv-panel-content" id="lv-categories-content">
    <!-- Aqu√≠ se cargar√°n las categor√≠as -->
  </div>
</div>

<!-- Panel de Subcategor√≠as (Nivel 3) -->
<div class="lv-panel lv-panel-subcategories" id="lv-panel-subcategories">
  <div class="lv-panel-header">
    <button class="lv-back-btn lv-mobile-only" id="lv-back-to-categories">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      <span>Volver</span>
    </button>
    <h2 class="lv-panel-title" id="lv-subcategories-title">Categor√≠a</h2>
  </div>
  <div class="lv-panel-content" id="lv-subcategories-content">
    <!-- Aqu√≠ se cargar√°n las subcategor√≠as -->
  </div>
</div>

<!-- CONTACT PANEL -->
<div id="contact-panel" class="contact-panel">
  <div class="contact-header">
    <h2>Ll√°menos</h2>
    <button type="button" id="close-contact-panel" class="close-btn" aria-label="Cerrar">√ó</button>
  </div>
  <div class="contact-content">
    <p>Donde sea que est√©, nuestro equipo estar√° encantado de atenderle.</p>
    <div class="contact-line"><i class="fa-solid fa-phone"></i><span>+52 332 211 8360</span></div>
    <div class="contact-line"><i class="fa-brands fa-whatsapp"></i><a href="https://wa.me/3322118360" target="_blank">WhatsApp</a></div>
    <hr>
    <p><strong>¬øNecesita ayuda?</strong></p>
    <ul class="contact-list">
      <li><a href="#">Preguntas Frecuentes</a></li>
      <li><a href="#">Servicio de Cuidados</a></li>
      <li><a href="#">Encontrar una Tienda</a></li>
      <li><a href="mailto:contacto@nowhere.mx">Enviar Correo</a></li>
    </ul>
  </div>
</div>

<!-- LOGIN PANEL (con Login y Registro en cascada) -->
<div id="login-panel" class="login-panel">
  <!-- Vista 1: LOGIN -->
  <div id="view-login" class="auth-view active">
    <div class="login-header">
      <h2>Identificaci√≥n</h2>
      <button type="button" id="close-login-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>
    <div class="login-section">
      <h3>Ya tengo una cuenta</h3>
      <span class="required-note">Campos requeridos*</span>

      <form id="loginForm" method="POST" action="#">
        <label for="username">Usuario o correo electr√≥nico*</label>
        <input type="text" id="username" required placeholder="Tu usuario o correo">

        <label for="password">Contrase√±a*</label>
        <div class="password-wrapper">
          <input type="password" id="password" placeholder="********" required autocomplete="current-password" autocapitalize="off" autocorrect="off" spellcheck="false">
          <button type="button" class="toggle-password" aria-label="Mostrar contrase√±a">
            <i class="fa-regular fa-eye"></i>
          </button>
        </div>

        <a href="{% url 'cliente_solicitar_reset' %}" class="forgot-link">¬øOlvid√≥ su contrase√±a?</a>

        <button type="submit" class="login-btn">Iniciar sesi√≥n</button>
        <p id="login-error" class="error-msg"></p>
      </form>
    </div>
    <hr>
    <div class="login-section">
      <h3>¬øNo tienes cuenta?</h3>
      <p>Crea tu cuenta en segundos y disfruta de una experiencia personalizada.</p>
      <button type="button" id="btn-show-register" class="register-btn">Crear cuenta</button>
    </div>
  </div>

  <!-- Vista 2: REGISTRO -->
  <div id="view-register" class="auth-view">
    <div class="login-header">
      <button type="button" id="btn-back-login" class="back-btn" aria-label="Volver al login">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Crear cuenta</h2>
      <button type="button" id="close-register-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>
    
    <div class="login-section">
      <p class="register-subtitle">√önete a N√∂wHƒórƒì en segundos</p>
      
      <form id="registerForm" method="POST" action="#">
        <label for="reg-email">Correo electr√≥nico*</label>
        <div class="input-with-icon">
          <input type="email" id="reg-email" required placeholder="tu@correo.com" autocomplete="email">
        </div>

        <label for="reg-pwd">Contrase√±a*</label>
        <div class="password-wrapper">
          <input type="password" id="reg-pwd" required minlength="8" placeholder="M√≠nimo 8 caracteres" autocomplete="new-password">
          <button type="button" class="toggle-password" aria-label="Mostrar contrase√±a">
            <i class="fa-regular fa-eye"></i>
          </button>
        </div>
        <div class="password-strength" id="regPwdStrength">
          <div class="strength-bar"><span></span></div>
          <small class="strength-text"></small>
        </div>

        <label for="reg-pwd2">Confirmar contrase√±a*</label>
        <div class="password-wrapper">
          <input type="password" id="reg-pwd2" required minlength="8" placeholder="Repite tu contrase√±a" autocomplete="new-password">
          <button type="button" class="toggle-password" aria-label="Mostrar contrase√±a">
            <i class="fa-regular fa-eye"></i>
          </button>
        </div>

        <button type="submit" class="login-btn register-submit-btn">
          <span class="btn-text">Crear cuenta</span>
          <span class="btn-loading" style="display:none;"><i class="fa-solid fa-spinner fa-spin"></i> Creando...</span>
        </button>
        <p id="register-error" class="error-msg"></p>
        <p id="register-success" class="success-msg"></p>
      </form>
      
      <p class="terms-note">
        Al crear tu cuenta, aceptas nuestros <a href="#">T√©rminos</a> y <a href="#">Privacidad</a>
      </p>
    </div>
    
    <hr>
    
    <div class="login-section register-benefits">
      <h4>Beneficios de tu cuenta</h4>
      <ul>
        <li><i class="fa-solid fa-check"></i> Historial de compras</li>
        <li><i class="fa-solid fa-check"></i> Checkout r√°pido</li>
        <li><i class="fa-solid fa-check"></i> Ofertas exclusivas</li>
      </ul>
    </div>
  </div>
</div>

<!-- CLIENTE PANEL -->
<div id="cliente-panel" class="login-panel">
  
  <!-- Vista Principal -->
  <div id="view-cliente-main" class="auth-view active">
    <div class="cliente-header">
      <h2 id="cliente-header-title">Mi Perfil</h2>
      <button type="button" id="close-cliente-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>
    
    <div class="login-section">
      <h3>Informaci√≥n de la cuenta</h3>
      <p class="info-line">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
        </svg>
        <span id="cliente-username"></span>
      </p>
      <p class="info-line">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <rect x="2" y="4" width="20" height="16" rx="2"/>
          <path d="M22 6L12 13 2 6"/>
        </svg>
        <span id="cliente-email"></span>
      </p>
    </div>
    
    <hr>
    
    <div class="login-section quick-links">
      <a href="#" id="link-editar-perfil">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <line x1="4" y1="6" x2="20" y2="6"/>
          <line x1="4" y1="12" x2="14" y2="12"/>
          <line x1="4" y1="18" x2="18" y2="18"/>
          <circle cx="18" cy="6" r="2"/>
          <circle cx="12" cy="12" r="2"/>
          <circle cx="16" cy="18" r="2"/>
        </svg>
        Editar perfil
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
      <a href="#" id="link-mis-pedidos">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <rect x="3" y="5" width="18" height="14" rx="2"/>
          <path d="M3 9h18"/>
          <circle cx="8" cy="15" r="1"/>
          <circle cx="16" cy="15" r="1"/>
        </svg>
        Mis pedidos
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
      <a href="#" id="link-carrito">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        Carrito
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
      <a href="#" id="link-wishlist">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 21l7.8-7.8 1-1a5.5 5.5 0 0 0 0-7.8z"/>
        </svg>
        Wishlist
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
      <a href="#" id="link-contacto">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
             stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
          <rect x="2" y="4" width="20" height="16" rx="2"/>
          <path d="M22 6L12 13 2 6"/>
        </svg>
        Cont√°ctanos
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    </div>
    
    <hr>
    
    <div class="login-section">
      <a href="#" id="link-logout" class="logout-btn">Cerrar sesi√≥n</a>
    </div>
  </div>

  <!-- Vista Mis Pedidos -->
  <div id="view-cliente-pedidos" class="auth-view">
    <div class="cliente-header">
      <button type="button" id="btn-back-cliente" class="back-btn" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Mis Pedidos</h2>
      <button type="button" id="close-pedidos-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>

    <div class="login-section">
      <div id="pedidos-loading" class="pedidos-loading">
        <i class="fa-solid fa-spinner fa-spin"></i> Cargando pedidos...
      </div>
      
      <div id="pedidos-empty" class="pedidos-empty" style="display: none;">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="5" width="18" height="14" rx="2"/>
          <path d="M3 9h18"/>
        </svg>
        <p>No tienes pedidos a√∫n</p>
        <a href="/coleccion/todos/" class="btn-explorar">Explorar productos</a>
      </div>

      <div id="pedidos-lista" class="pedidos-lista"></div>
    </div>

    <div class="login-section" id="pedidos-ver-mas" style="display: none;">
      <a href="{% url 'mis_pedidos' %}" class="btn-ver-historial">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Ver historial completo
      </a>
    </div>
  </div>

  <!-- Vista Editar Perfil -->
  <div id="view-cliente-perfil" class="auth-view">
    <div class="cliente-header">
      <button type="button" id="btn-back-perfil" class="back-btn" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Editar Perfil</h2>
      <button type="button" id="close-perfil-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>

    <!-- Mensaje para completar perfil -->
    <div id="perfil-completar-msg" class="perfil-completar-msg" style="display: none;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 16v-4M12 8h.01"/>
      </svg>
      <span>Completa tu perfil para una mejor experiencia de compra</span>
    </div>

    <!-- Tabs de perfil -->
    <nav class="perfil-tabs" role="tablist">
      <button type="button" class="perfil-tab-btn active" data-perfil-tab="info">Informaci√≥n</button>
      <button type="button" class="perfil-tab-btn" data-perfil-tab="direccion">Direcci√≥n</button>
      <button type="button" class="perfil-tab-btn" data-perfil-tab="seguridad">Seguridad</button>
    </nav>

    <!-- Tab: Informaci√≥n Personal -->
    <div class="perfil-tab-content active" id="perfil-tab-info">
      <div class="login-section">
        <div class="perfil-section-header">
          <span class="perfil-section-title">Informaci√≥n Personal</span>
          <button type="button" class="perfil-btn-edit" id="btn-edit-info">Editar</button>
        </div>
        
        <form id="form-info" class="perfil-form">
          <div class="perfil-field">
            <label>Nombre Completo</label>
            <input type="text" id="perfil-nombre" placeholder="Agrega tu nombre" disabled>
          </div>
          
          <div class="perfil-field">
            <label>Usuario</label>
            <input type="text" id="perfil-username" disabled>
            <small class="perfil-hint" id="username-hint"></small>
          </div>
          
          <div class="perfil-field">
            <label>
              Correo Electr√≥nico
              <span class="perfil-badge" id="email-verified-badge"></span>
            </label>
            <input type="email" id="perfil-correo" disabled>
          </div>
          
          <div class="perfil-field">
            <label>Tel√©fono</label>
            <input type="tel" id="perfil-telefono" placeholder="10 d√≠gitos" disabled>
          </div>

          <div class="perfil-form-actions" id="actions-info" style="display: none;">
            <button type="button" class="perfil-btn-cancel" onclick="cancelarEdicionPerfil('info')">Cancelar</button>
            <button type="submit" class="perfil-btn-save">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Tab: Direcci√≥n -->
    <div class="perfil-tab-content" id="perfil-tab-direccion">
      <div class="login-section">
        <div class="perfil-section-header">
          <span class="perfil-section-title">Direcci√≥n de Env√≠o</span>
          <button type="button" class="perfil-btn-edit" id="btn-edit-direccion">Editar</button>
        </div>
        
        <form id="form-direccion" class="perfil-form">
          <div class="perfil-field">
            <label>Calle y N√∫mero</label>
            <input type="text" id="perfil-calle" placeholder="Av. Ejemplo 123" disabled>
          </div>
          
          <div class="perfil-field-row">
            <div class="perfil-field">
              <label>Colonia</label>
              <input type="text" id="perfil-colonia" disabled>
            </div>
            <div class="perfil-field">
              <label>C.P.</label>
              <input type="text" id="perfil-cp" placeholder="00000" maxlength="5" disabled>
            </div>
          </div>
          
          <div class="perfil-field-row">
            <div class="perfil-field">
              <label>Ciudad</label>
              <input type="text" id="perfil-ciudad" disabled>
            </div>
            <div class="perfil-field">
              <label>Estado</label>
              <select id="perfil-estado" disabled>
                <option value="">Seleccionar</option>
                <option value="Aguascalientes">Aguascalientes</option>
                <option value="Baja California">Baja California</option>
                <option value="Baja California Sur">Baja California Sur</option>
                <option value="Campeche">Campeche</option>
                <option value="Chiapas">Chiapas</option>
                <option value="Chihuahua">Chihuahua</option>
                <option value="Ciudad de M√©xico">Ciudad de M√©xico</option>
                <option value="Coahuila">Coahuila</option>
                <option value="Colima">Colima</option>
                <option value="Durango">Durango</option>
                <option value="Guanajuato">Guanajuato</option>
                <option value="Guerrero">Guerrero</option>
                <option value="Hidalgo">Hidalgo</option>
                <option value="Jalisco">Jalisco</option>
                <option value="M√©xico">Estado de M√©xico</option>
                <option value="Michoac√°n">Michoac√°n</option>
                <option value="Morelos">Morelos</option>
                <option value="Nayarit">Nayarit</option>
                <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                <option value="Oaxaca">Oaxaca</option>
                <option value="Puebla">Puebla</option>
                <option value="Quer√©taro">Quer√©taro</option>
                <option value="Quintana Roo">Quintana Roo</option>
                <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                <option value="Sinaloa">Sinaloa</option>
                <option value="Sonora">Sonora</option>
                <option value="Tabasco">Tabasco</option>
                <option value="Tamaulipas">Tamaulipas</option>
                <option value="Tlaxcala">Tlaxcala</option>
                <option value="Veracruz">Veracruz</option>
                <option value="Yucat√°n">Yucat√°n</option>
                <option value="Zacatecas">Zacatecas</option>
              </select>
            </div>
          </div>
          
          <div class="perfil-field">
            <label>Referencias</label>
            <textarea id="perfil-referencias" rows="2" placeholder="Entre calles, color de casa, etc." disabled></textarea>
          </div>

          <div class="perfil-form-actions" id="actions-direccion" style="display: none;">
            <button type="button" class="perfil-btn-cancel" onclick="cancelarEdicionPerfil('direccion')">Cancelar</button>
            <button type="submit" class="perfil-btn-save">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Tab: Seguridad -->
    <div class="perfil-tab-content" id="perfil-tab-seguridad">
      <div class="login-section">
        <div class="perfil-section-header">
          <span class="perfil-section-title">Cambiar Contrase√±a</span>
        </div>
        
        <form id="form-seguridad" class="perfil-form">
          <div class="perfil-field">
            <label>Contrase√±a Actual</label>
            <div class="password-wrapper">
              <input type="password" id="perfil-pwd-actual" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              <button type="button" class="toggle-password"><i class="fa-regular fa-eye"></i></button>
            </div>
          </div>
          
          <div class="perfil-field">
            <label>Nueva Contrase√±a</label>
            <div class="password-wrapper">
              <input type="password" id="perfil-pwd-nueva" placeholder="M√≠nimo 8 caracteres">
              <button type="button" class="toggle-password"><i class="fa-regular fa-eye"></i></button>
            </div>
            <div class="password-strength" id="perfilPwdStrength">
              <div class="strength-bar"></div>
              <small class="strength-text"></small>
            </div>
          </div>
          
          <div class="perfil-field">
            <label>Confirmar Nueva Contrase√±a</label>
            <div class="password-wrapper">
              <input type="password" id="perfil-pwd-confirmar" placeholder="Repite la contrase√±a">
              <button type="button" class="toggle-password"><i class="fa-regular fa-eye"></i></button>
            </div>
          </div>

          <div class="perfil-form-actions" style="display: flex;">
            <button type="submit" class="perfil-btn-save" style="width: 100%;">Cambiar Contrase√±a</button>
          </div>
          
          <p id="seguridad-error" class="error-msg"></p>
          <p id="seguridad-success" class="success-msg"></p>
        </form>
      </div>
    </div>

    <!-- Mensajes generales -->
    <p id="perfil-error" class="error-msg" style="padding: 0 20px;"></p>
    <p id="perfil-success" class="success-msg" style="padding: 0 20px;"></p>
  </div>

  <!-- Vista Carrito -->
  <div id="view-cliente-carrito" class="auth-view">
    <div class="cliente-header">
      <button type="button" id="btn-back-carrito" class="back-btn" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Mi Carrito</h2>
      <button type="button" id="close-carrito-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>

    <!-- Info de mayoreo -->
    <div id="carrito-mayoreo-msg" class="carrito-mayoreo-msg" style="display: none;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
      <span>¬°Precio de mayoreo aplicado!</span>
    </div>

    <!-- Contador de items -->
    <div class="carrito-counter">
      <span id="carrito-items-count">0 productos</span>
    </div>

    <!-- Lista de productos -->
    <div class="carrito-section">
      <div class="carrito-section-header">
        <span class="carrito-section-title">Productos</span>
        <button type="button" id="btn-vaciar-carrito" class="carrito-btn-vaciar" title="Vaciar carrito">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Vaciar
        </button>
      </div>
      <div class="carrito-items-list" id="carrito-items-container">
        <p class="carrito-loading">Cargando...</p>
      </div>
    </div>

    <!-- Resumen del pedido -->
    <div class="carrito-section carrito-resumen">
      <div class="carrito-section-header">
        <span class="carrito-section-title">Resumen</span>
      </div>
      <div class="carrito-resumen-rows">
        <div class="carrito-resumen-row">
          <span>Subtotal</span>
          <span id="carrito-subtotal">$0</span>
        </div>
        <div class="carrito-resumen-row">
          <span>Env√≠o</span>
          <span id="carrito-envio" class="carrito-envio-calc">Calcular al checkout</span>
        </div>
        <div class="carrito-resumen-row carrito-total-row">
          <span>Total</span>
          <strong id="carrito-total-final">$0</strong>
        </div>
      </div>
    </div>

    <!-- Bot√≥n de checkout -->
    <div class="carrito-actions">
      <a href="/carrito/cliente/" class="carrito-btn-checkout" id="btn-checkout">
        Proceder al pago
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12"/>
          <polyline points="12 5 19 12 12 19"/>
        </svg>
      </a>
      <p class="carrito-secure-text">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        Pago 100% seguro
      </p>
    </div>
  </div>

  <!-- Vista Wishlist -->
  <div id="view-cliente-wishlist" class="auth-view">
    <div class="cliente-header">
      <button type="button" id="btn-back-wishlist" class="back-btn" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Mis Favoritos</h2>
      <button type="button" id="close-wishlist-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>
    <div class="wishlist-content">
      <p>Cargando tus productos favoritos...</p>
    </div>
  </div>

  <!-- Vista Cont√°ctanos -->
  <div id="view-cliente-contacto" class="auth-view">
    <div class="cliente-header">
      <button type="button" id="btn-back-contacto" class="back-btn" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h2>Ll√°menos</h2>
      <button type="button" id="close-contacto-panel" class="close-btn" aria-label="Cerrar">√ó</button>
    </div>

    <div class="contact-content">
      <p>Donde sea que est√©, nuestro equipo estar√° encantado de atenderle.</p>
      <div class="contact-line"><i class="fa-solid fa-phone"></i><span>+52 332 211 8360</span></div>
      <div class="contact-line"><i class="fa-brands fa-whatsapp"></i><a href="https://wa.me/3322118360" target="_blank">WhatsApp</a></div>
      <hr>
      <p><strong>¬øNecesita ayuda?</strong></p>
      <ul class="contact-list">
        <li><a href="#">Preguntas Frecuentes</a></li>
        <li><a href="#">Servicio de Cuidados</a></li>
        <li><a href="#">Encontrar una Tienda</a></li>
        <li><a href="mailto:contacto@nowhere.mx">Enviar Correo</a></li>
      </ul>
    </div>
  </div>
</div>

<!-- WISHLIST PANEL (panel separado desde header) -->
<div id="wishlist-panel" class="login-panel">
  <div class="login-header">
    <h2 id="wishlist-header-title">Mis Favoritos</h2>
    <button type="button" id="close-wishlist-header" class="close-btn" aria-label="Cerrar">√ó</button>
  </div>
  <div class="wishlist-content wishlist-header-content">
    <!-- JS renderiza los productos -->
  </div>
</div>

<!-- SEARCH OVERLAY -->
<div id="search-overlay" class="search-overlay">
  <div class="search-overlay-container">
    <!-- Header del buscador -->
    <div class="search-overlay-header">
      <div class="search-input-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          id="search-overlay-input" 
          class="search-overlay-input" 
          placeholder="Buscar productos..."
          autocomplete="off"
          autofocus
        >
        <button id="search-clear-btn" class="search-clear-btn" style="display: none;" aria-label="Limpiar b√∫squeda">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
               stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <button id="search-close-btn" class="search-close-btn" aria-label="Cerrar b√∫squeda">
        Cancelar
      </button>
    </div>

    <!-- Contenido del buscador -->
    <div class="search-overlay-content">
      <!-- Estado inicial: Sugerencias -->
      <div id="search-suggestions" class="search-suggestions">
        <h3>B√∫squedas populares</h3>
        <div class="suggestion-tags">
          <button class="suggestion-tag" data-query="Tacones">Tacones</button>
          <button class="suggestion-tag" data-query="Botas">Botas</button>
          <button class="suggestion-tag" data-query="Sandalias">Sandalias</button>
          <button class="suggestion-tag" data-query="Tenis">Tenis</button>
          <button class="suggestion-tag" data-query="Flats">Flats</button>
        </div>
        <h3>Categor√≠as</h3>
        <div class="search-categories">
          <a href="{% url 'coleccion_genero' 'dama' %}" class="search-category-link">
            <span>Dama</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
          <a href="{% url 'coleccion_genero' 'caballero' %}" class="search-category-link">
            <span>Caballero</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
          <a href="{% url 'coleccion_genero' 'accesorios' %}" class="search-category-link">
            <span>Accesorios</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Estado: Cargando -->
      <div id="search-loading" class="search-loading" style="display: none;">
        <div class="search-spinner"></div>
        <p>Buscando...</p>
      </div>

      <!-- Estado: Resultados -->
      <div id="search-results" class="search-results" style="display: none;">
        <div class="search-results-header">
          <span id="search-results-count">0 resultados</span>
          <a href="#" id="search-view-all" class="search-view-all">Ver todos</a>
        </div>
        <div id="search-results-grid" class="search-results-grid">
          <!-- Productos se cargan din√°micamente -->
        </div>
      </div>

      <!-- Estado: Sin resultados -->
      <div id="search-no-results" class="search-no-results" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" 
             stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
          <path d="M8 8l6 6M14 8l-6 6"/>
        </svg>
        <h3>No encontramos resultados</h3>
        <p>Intenta con otros t√©rminos de b√∫squeda</p>
      </div>
    </div>
  </div>
</div>

<!-- Overlay com√∫n -->
<div class="page-overlay"></div>

<script>
  window.mostrarLoginPanel = function () {
    const loginPanel = document.getElementById('login-panel');
    const overlay = document.querySelector('.page-overlay');
    if (loginPanel) loginPanel.classList.add('open');
    if (overlay) overlay.classList.add('active');
    document.body.classList.add('no-scroll');
  };
</script>

<!-- Toggle Password Visibility -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const pwd = document.getElementById("password");
  const btn = document.querySelector(".toggle-password");

  if (pwd && btn) {
    const icon = btn.querySelector("i");

    btn.addEventListener("click", () => {
      const oculto = pwd.type === "password";
      pwd.type = oculto ? "text" : "password";

      icon.classList.toggle("fa-eye");
      icon.classList.toggle("fa-eye-slash");

      btn.setAttribute(
        "aria-label",
        oculto ? "Ocultar contrase√±a" : "Mostrar contrase√±a"
      );
    });
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const isLogged  = !!localStorage.getItem("access");
  const userId    = localStorage.getItem("user_id");
  const role      = localStorage.getItem("role");
  const btnLogin  = document.getElementById("btn-login");
  const btnUser   = document.getElementById("btn-user-menu");
  const clientePanel = document.getElementById("cliente-panel");

  // Si es un token de admin, no mostrar panel cliente en la p√É¬°gina p√É¬∫blica
  if (role === "admin" || role === "user") {
    if (btnLogin) btnLogin.style.display = "inline-flex";
    if (btnUser)  btnUser.style.display = "none";
    btnLogin?.addEventListener("click", () => { mostrarLoginPanel(); });
    return;
  }

  if (isLogged && userId) {
    // mostrar bot√≥n de usuario, ocultar login
    if (btnUser)  btnUser.style.display = "inline-flex";
    if (btnLogin) btnLogin.style.display = "none";

    // opcional: mostrar nombre y email en panel
    const nombre = localStorage.getItem("nombre") || localStorage.getItem("username") || "";
    const correo = localStorage.getItem("correo") || "";
    if (nombre) {
      document.getElementById("cliente-username").textContent = nombre;
    }
    if (correo) {
      document.getElementById("cliente-email").textContent = correo;
    } else {
      document.getElementById("cliente-email").textContent = "(sin email)";
    }

    // acci√≥n al abrir panel de usuario
    btnUser?.addEventListener("click", () => {
      clientePanel.classList.add("open");
      document.querySelector(".page-overlay").classList.add("active");
    });

    // logout
    document.getElementById("link-logout")?.addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("access");
      localStorage.removeItem("refresh");
      localStorage.removeItem("user_id");
      localStorage.removeItem("role");
      localStorage.removeItem("username");
      localStorage.removeItem("nombre");
      localStorage.removeItem("correo");
      window.location.reload();
    });

  } else {
    // mostrar bot√≥n de login, ocultar usuario
    if (btnLogin) btnLogin.style.display = "inline-flex";
    if (btnUser)  btnUser.style.display = "none";

    btnLogin?.addEventListener("click", () => {
      mostrarLoginPanel();
    });
  }
});
</script>

