{% load static %}
<!-- HEADER -->
<header>
  <div class="header-left fade-in">
    <button id="btn-burger" class="burger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <span class="menu-label"></span>
    
    <!-- üîç B√∫squeda (solo m√≥vil) -->
    <button id="btn-search-mobile" class="user-icon search-mobile" aria-label="Buscar productos">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
    </button>
  </div>

  <div class="header-center">
    <a href="{% url 'index' %}">
      <img src="{% static 'images/NowHere.svg' %}" id="Logo" class="fade-in" alt="N√∂wHƒórƒì">
    </a>
  </div>

  <div class="header-right fade-in">
    <button id="btn-contacto" class="btn-contacto">Cont√°ctanos</button>

    <!-- üîç B√∫squeda (solo desktop) -->
    <button id="btn-search" class="user-icon search-desktop" aria-label="Buscar productos">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
    </button>

    <!-- ‚ù§Ô∏è Wishlist -->
    <button id="btn-wishlist-panel" class="user-icon" aria-label="Ver wishlist">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
          fill="none" stroke="currentColor" stroke-width="1.5"
          stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 21l7.8-7.8 1-1a5.5 5.5 0 0 0 0-7.8z"/>
      </svg>
      <span id="wishlist-count" class="wishlist-count" hidden>0</span>
    </button>

    <!-- üõí Carrito -->
    <button id="btn-cart-panel" class="user-icon" aria-label="Ver carrito"
            onclick="window.location.href='{% url 'ver_carrito' %}'">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M6 2l1 4h10l1-4"/>
        <path d="M3 6h18l-1.5 12.5a2 2 0 0 1-2 1.5H6.5a2 2 0 0 1-2-1.5L3 6z"/>
        <path d="M9 10v2"/>
        <path d="M15 10v2"/>
      </svg>
    </button>

    <!-- ‚ñº Ambos botones, se muestran/ocultan con JS -->
    <!-- Icono login (invitado) -->
    <button id="btn-login" class="user-icon" aria-label="Iniciar sesi√≥n" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="8" r="4"/>
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
      </svg>
    </button>

    <!-- Icono usuario (logueado) -->
    <button id="btn-user-menu" class="user-icon" aria-label="Men√∫ de usuario" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="8" r="4"/>
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
      </svg>
    </button>
  </div>
</header>

<!-- NAV MENU -->
<nav class="nav-menu">
   <button class="close-menu" id="btn-close-menu" aria-label="Cerrar men√∫">√ó</button>
  <ul class="menu">
    <li><a href="{% url 'index' %}">Inicio</a></li>
    <li><a href="{% url 'coleccion_genero' 'dama' %}">Dama</a></li>
    <li><a href="{% url 'coleccion_genero' 'caballero' %}">Caballero</a></li>
    <li><a href="{% url 'coleccion_genero' 'accesorios' %}">Accesorios</a></li>
    <li><a href="{% url 'coleccion_genero' '#' %}">Todo</a></li>
  </ul>
</nav>

<!-- CONTACT PANEL -->
<div id="contact-panel" class="contact-panel">
  <div class="contact-header">
    <h2>Ll√°menos</h2>
    <span id="close-contact-panel" class="close-btn">√ó</span>
  </div>
  <div class="contact-content">
    <p>Donde sea que est√©, nuestro equipo estar√° encantado de atenderle.</p>
    <div class="contact-line"><i class="fa-solid fa-phone"></i><span>+52 332 211 8360</span></div>
    <div class="contact-line"><i class="fa-brands fa-whatsapp"></i><a href="https://wa.me/3322118360" target="_blank">WhatsApp</a></div>
    <hr>
    <p><strong>¬øNecesita ayuda?</strong></p>
    <ul class="contact-list">
      <li><a href="#">Preguntas Frecuentes</a></li>
      <li><a href="#">Servicio de Cuidados</a></li>
      <li><a href="#">Encontrar una Tienda</a></li>
      <li><a href="mailto:contacto@nowhere.mx">Enviar Correo</a></li>
    </ul>
  </div>
</div>

<!-- LOGIN PANEL -->
<div id="login-panel" class="login-panel">
  <div class="login-header">
    <h2>Identificaci√≥n</h2>
    <span id="close-login-panel" class="close-btn">√ó</span>
  </div>
  <div class="login-section">
    <h3>Ya Tengo una Cuenta</h3>
    <span class="required-note">Campos requeridos*</span>

    <form id="loginForm" method="POST" action="#">
      <label for="username">Usuario*</label>
      <input type="text" id="username" required>

      <label for="password">Contrase√±a*</label>
      <div class="password-wrapper">
        <input type="password" id="password" required autocomplete="current-password" autocapitalize="off" autocorrect="off" spellcheck="false">
        <button type="button" class="toggle-password" aria-label="Mostrar contrase√±a">
          <i class="fa-regular fa-eye"></i>
        </button>
      </div>

      <a href="{% url 'cliente_solicitar_reset' %}" class="forgot-link">¬øOlvid√≥ su contrase√±a?</a>

      <p class="login-alt-text">O use un enlace de acceso √∫nico para iniciar sesi√≥n:<br>
        <a href="{% url 'cliente_solicitar_reset' %}" class="email-login-link">Enviarme el enlace por correo electr√≥nico</a>
      </p>

      <button type="submit" class="login-btn">Iniciar sesi√≥n</button>
      <p id="login-error" class="error-msg"></p>
    </form>
  </div>
  <hr>
  <div class="login-section">
    <h3>No tengo cuenta</h3>
    <p>Disfrute de beneficios adicionales y de una experiencia m√°s intensa creando una cuenta personal.</p>
    <a href="{% url 'registrarse' %}" class="register-btn">Crear cuenta N:</a>
  </div>
</div>

<!-- CLIENTE PANEL -->
<div id="cliente-panel" class="login-panel">
  <div class="cliente-header">
    <h2 id="cliente-header-title">Mi Perfil</h2>
    <span id="close-cliente-panel" class="close-btn">√ó</span>
  </div>
  
  <div class="login-section">
    <h3>Informaci√≥n de la cuenta</h3>
    <p class="info-line">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="8" r="4"/>
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
      </svg>
      <span id="cliente-username"></span>
    </p>
    <p class="info-line">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <rect x="2" y="4" width="20" height="16" rx="2"/>
        <path d="M22 6L12 13 2 6"/>
      </svg>
      <span id="cliente-email"></span>
    </p>
  </div>
  
  <hr>
  
  <div class="login-section quick-links">
    <a href="#" id="link-perfil">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <line x1="4" y1="6" x2="20" y2="6"/>
        <line x1="4" y1="12" x2="14" y2="12"/>
        <line x1="4" y1="18" x2="18" y2="18"/>
        <circle cx="18" cy="6" r="2"/>
        <circle cx="12" cy="12" r="2"/>
        <circle cx="16" cy="18" r="2"/>
      </svg>
      Editar perfil
    </a>
    <a href="{% url 'mis_pedidos' %}">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <rect x="3" y="5" width="18" height="14" rx="2"/>
        <path d="M3 9h18"/>
        <circle cx="8" cy="15" r="1"/>
        <circle cx="16" cy="15" r="1"/>
      </svg>
      Mis pedidos
    </a>
    <a href="#" id="link-wishlist" class="open-wishlist">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 21l7.8-7.8 1-1a5.5 5.5 0 0 0 0-7.8z"/>
      </svg>
      Wishlist
    </a>
    <a href="/contacto/">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
           stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <rect x="2" y="4" width="20" height="16" rx="2"/>
        <path d="M22 6L12 13 2 6"/>
      </svg>
      Cont√°ctanos
    </a>
  </div>
  
  <hr>
  
  <div class="login-section">
    <a href="#" id="link-logout" class="logout-btn">Cerrar sesi√≥n</a>
  </div>
</div>

<!-- WISHLIST PANEL -->
<div id="wishlist-panel" class="login-panel">
  <div class="wishlist-header">
    <h2 id="wishlist-header-title">Favoritos</h2>
    <span id="close-wishlist-panel" class="close-btn">√ó</span>
  </div>
  <div class="wishlist-content">
    <p>Cargando tus productos favoritos...</p>
  </div>
</div>

<!-- SEARCH OVERLAY -->
<div id="search-overlay" class="search-overlay">
  <div class="search-overlay-container">
    <!-- Header del buscador -->
    <div class="search-overlay-header">
      <div class="search-input-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          id="search-overlay-input" 
          class="search-overlay-input" 
          placeholder="Buscar productos..."
          autocomplete="off"
          autofocus
        >
        <button id="search-clear-btn" class="search-clear-btn" style="display: none;" aria-label="Limpiar b√∫squeda">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" 
               stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <button id="search-close-btn" class="search-close-btn" aria-label="Cerrar b√∫squeda">
        Cancelar
      </button>
    </div>

    <!-- Contenido del buscador -->
    <div class="search-overlay-content">
      <!-- Estado inicial: Sugerencias -->
      <div id="search-suggestions" class="search-suggestions">
        <h3>B√∫squedas populares</h3>
        <div class="suggestion-tags">
          <button class="suggestion-tag" data-query="Tacones">Tacones</button>
          <button class="suggestion-tag" data-query="Botas">Botas</button>
          <button class="suggestion-tag" data-query="Sandalias">Sandalias</button>
          <button class="suggestion-tag" data-query="Tenis">Tenis</button>
          <button class="suggestion-tag" data-query="Flats">Flats</button>
        </div>
        <h3>Categor√≠as</h3>
        <div class="search-categories">
          <a href="{% url 'coleccion_genero' 'dama' %}" class="search-category-link">
            <span>Dama</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
          <a href="{% url 'coleccion_genero' 'caballero' %}" class="search-category-link">
            <span>Caballero</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
          <a href="{% url 'coleccion_genero' 'accesorios' %}" class="search-category-link">
            <span>Accesorios</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" 
                 stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Estado: Cargando -->
      <div id="search-loading" class="search-loading" style="display: none;">
        <div class="search-spinner"></div>
        <p>Buscando...</p>
      </div>

      <!-- Estado: Resultados -->
      <div id="search-results" class="search-results" style="display: none;">
        <div class="search-results-header">
          <span id="search-results-count">0 resultados</span>
          <a href="#" id="search-view-all" class="search-view-all">Ver todos</a>
        </div>
        <div id="search-results-grid" class="search-results-grid">
          <!-- Productos se cargan din√°micamente -->
        </div>
      </div>

      <!-- Estado: Sin resultados -->
      <div id="search-no-results" class="search-no-results" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" 
             stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
          <path d="M8 8l6 6M14 8l-6 6"/>
        </svg>
        <h3>No encontramos resultados</h3>
        <p>Intenta con otros t√©rminos de b√∫squeda</p>
      </div>
    </div>
  </div>
</div>

<!-- Overlay com√∫n -->
<div class="page-overlay"></div>

<script>
  window.mostrarLoginPanel = function () {
    const loginPanel = document.getElementById('login-panel');
    const overlay = document.querySelector('.page-overlay');
    if (loginPanel) loginPanel.classList.add('open');
    if (overlay) overlay.classList.add('active');
    document.body.classList.add('no-scroll');
  };
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const isLogged  = !!localStorage.getItem("access");
  const userId    = localStorage.getItem("user_id");
  const btnLogin  = document.getElementById("btn-login");
  const btnUser   = document.getElementById("btn-user-menu");
  const clientePanel = document.getElementById("cliente-panel");

  if (isLogged && userId) {
    // mostrar bot√≥n de usuario, ocultar login
    if (btnUser)  btnUser.style.display = "inline-flex";
    if (btnLogin) btnLogin.style.display = "none";

    // opcional: mostrar nombre y email en panel
    const nombre = localStorage.getItem("nombre") || localStorage.getItem("username") || "";
    const correo = localStorage.getItem("correo") || "";
    if (nombre) {
      document.getElementById("cliente-username").textContent = nombre;
    }
    if (correo) {
      document.getElementById("cliente-email").textContent = correo;
    } else {
      document.getElementById("cliente-email").textContent = "(sin email)";
    }

    // acci√≥n al abrir panel de usuario
    btnUser?.addEventListener("click", () => {
      clientePanel.classList.add("open");
      document.querySelector(".page-overlay").classList.add("active");
    });

    // logout
    document.getElementById("link-logout")?.addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("access");
      localStorage.removeItem("refresh");
      localStorage.removeItem("user_id");
      localStorage.removeItem("role");
      localStorage.removeItem("username");
      localStorage.removeItem("nombre");
      localStorage.removeItem("correo");
      window.location.reload();
    });

  } else {
    // mostrar bot√≥n de login, ocultar usuario
    if (btnLogin) btnLogin.style.display = "inline-flex";
    if (btnUser)  btnUser.style.display = "none";

    btnLogin?.addEventListener("click", () => {
      mostrarLoginPanel();
    });
  }
});
</script>

