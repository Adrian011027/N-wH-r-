{% extends "public/base.html" %}
{% load static %}

{% block title %}Mi Carrito - NÃ¶wHÄ—rÄ“{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'public/carrito/css/carrito.css' %}">
{% endblock %}

{% block content %}
<div class="carrito-container" id="carrito-container">

  <h1 class="carrito-titulo">Carrito</h1>

  <!-- ðŸ”” Alerta de piezas restantes para mayoreo -->
  <div id="alerta-meta-mayoreo" class="alert-meta-mayoreo" style="display: none;">
    <div class="scroll-wrapper">
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
    </div>
  </div>

  <!-- âœ… Alerta de mayoreo activado -->
  <div id="alerta-mayoreo" class="alert-mayoreo" style="display: none;">
    <div class="scroll-wrapper">
      <span> EstÃ¡s comprando al <strong>precio de mayoreo</strong>. Â¡Aprovecha tus ahorros! </span>
      <span> EstÃ¡s comprando al <strong>precio de mayoreo</strong>. Â¡Aprovecha tus ahorros! </span>
    </div>
  </div>

  <!-- ðŸ›’ Contenido activo del carrito -->
  <div id="carrito-activo" style="display: none;">
    <div class="carrito-items" id="carrito-items">
      <!-- Se inyectan productos dinÃ¡micamente con JS -->
    </div>

    <div class="carrito-resumen">
      <p>Subtotal: <strong id="carrito-subtotal">$0.00</strong></p>
      <div class="carrito-botones">
        <button class="btn-vaciar">Vaciar Carrito</button>

        <a href="{% url 'index' %}" class="btn-seguir">Seguir comprando</a>
      </div>
    </div>
  </div>

  <!-- ðŸª£ Vista carrito vacÃ­o -->
  <div id="carrito-vacio" style="display: none;">
    <section class="carrito-vacio-section">
      {% if request.session.cliente_id %}
        <h2>Tu carrito estÃ¡ vacÃ­o</h2>
        <p>AÃ±ade productos para verlos aquÃ­.</p>
        <a href="{% url 'index' %}" class="btn">Ir a la tienda</a>
      {% else %}
        <h2>Tu carrito estÃ¡ vacÃ­o</h2>
        <p>Inicia sesiÃ³n para ver tu carrito de compra.</p>
        <a href="#" onclick="mostrarLoginPanel()" class="btn">Iniciar sesiÃ³n</a>
      {% endif %}
    </section>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  const CLIENTE_ID   = {{ request.session.cliente_id|default:"0" }};
  const SESSION_KEY  = "{{ request.session.session_key|default:'' }}";
</script>

<script src="{% static 'public/carrito/js/carrito.js' %}"></script>
<script type="module" src="{% static 'public/inicio/js/main.js' %}" defer></script>
{% endblock %}
