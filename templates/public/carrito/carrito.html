{% extends "public/base.html" %}
{% load static %}

{% block title %}Mi Carrito - NÃ¶wHÄ—rÄ“{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'public/carrito/css/carrito.css' %}">
{% endblock %}

{% block content %}
<div class="carrito-container" id="carrito-container">

  <h1 class="carrito-titulo">Carrito</h1>

  <!-- ðŸ”” Alerta de piezas restantes para mayoreo -->
  <div id="alerta-meta-mayoreo" class="alert-meta-mayoreo" style="display: none;">
    <div class="scroll-wrapper">
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
      <span> Solo te faltan <strong class="piezas-restantes">4</strong> piezas para alcanzar el <strong>precio de mayoreo</strong>. Â¡Aprovecha la oferta! </span>
    </div>
  </div>

  <!-- âœ… Alerta de mayoreo activado -->
  <div id="alerta-mayoreo" class="alert-mayoreo" style="display: none;">
    <div class="scroll-wrapper">
      <span> EstÃ¡s comprando al <strong>precio de mayoreo</strong>. Â¡Aprovecha tus ahorros! </span>
      <span> EstÃ¡s comprando al <strong>precio de mayoreo</strong>. Â¡Aprovecha tus ahorros! </span>
    </div>
  </div>

  <!-- ðŸ›’ Contenido activo del carrito -->
  <div id="carrito-activo" style="display: none;">
    <div class="carrito-items" id="carrito-items">
      <!-- Se inyectan productos dinÃ¡micamente con JS -->
    </div>

    <div class="carrito-resumen">
      <p>Subtotal: <strong id="carrito-subtotal">$0.00</strong></p>
      <div class="carrito-botones">
        <button class="btn-vaciar">Vaciar Carrito</button>
        <a href="{% url 'index' %}" class="btn-seguir">Seguir comprando</a>
      </div>
    </div>
  </div>

  <!-- ðŸª£ Vista carrito vacÃ­o -->
  <div id="carrito-vacio" style="display: none;">
    <section class="carrito-vacio-section">
      <h2>Tu carrito estÃ¡ vacÃ­o</h2>
      <p id="carrito-msg"></p>
      <a href="#" id="carrito-cta" class="btn"></a>
    </section>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  // âœ… Ahora se controla desde localStorage y JWT
  const CLIENTE_ID = localStorage.getItem("user_id") || 0;
  const TOKEN      = localStorage.getItem("access");
  const IS_LOGGED  = !!TOKEN;

  document.addEventListener("DOMContentLoaded", () => {
    const msg = document.getElementById("carrito-msg");
    const cta = document.getElementById("carrito-cta");

    if (IS_LOGGED) {
      msg.textContent = "AÃ±ade productos para verlos aquÃ­.";
      cta.textContent = "Ir a la tienda";
      cta.href = "{% url 'index' %}";
    } else {
      msg.textContent = "Inicia sesiÃ³n para ver tu carrito de compra.";
      cta.textContent = "Iniciar sesiÃ³n";
      cta.href = "#";
      cta.onclick = () => mostrarLoginPanel();
    }
  });
</script>

<script src="{% static 'public/carrito/js/carrito.js' %}"></script>
<script type="module" src="{% static 'public/inicio/js/main.js' %}" defer></script>
{% endblock %}
