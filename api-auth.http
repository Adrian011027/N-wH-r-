### ============================================
### API de Autenticación JWT - REST Client
### ============================================
### Para usar en VS Code con la extensión REST Client
### https://marketplace.visualstudio.com/items?itemName=humao.rest-client

@baseUrl = http://localhost:8000/api
@username = angel
@password = 123456

### ============================================
### AUTENTICACIÓN
### ============================================

### 1. Login - Obtener tokens
# @name login
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "username": "{{username}}",
  "password": "{{password}}"
}

### Guardar tokens de la respuesta anterior
@accessToken = {{login.response.body.access_token}}
@refreshToken = {{login.response.body.refresh_token}}

### 2. Verificar Token
POST {{baseUrl}}/auth/verify/
Authorization: Bearer {{accessToken}}

### 3. Renovar Access Token
POST {{baseUrl}}/auth/refresh/
Content-Type: application/json

{
  "refresh_token": "{{refreshToken}}"
}

### 4. Logout
POST {{baseUrl}}/auth/logout/
Authorization: Bearer {{accessToken}}


### ============================================
### USUARIOS (Solo Admin)
### ============================================

### 5. Obtener todos los usuarios
GET {{baseUrl}}/users/
Authorization: Bearer {{accessToken}}

### 6. Crear usuario
POST {{baseUrl}}/users/create/
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "username": "nuevo_usuario",
  "password": "password123",
  "role": "user"
}

### 7. Actualizar usuario (cambiar el ID según necesites)
PUT {{baseUrl}}/users/update/2/
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "username": "usuario_actualizado",
  "password": "nueva_password",
  "role": "admin"
}

### 8. Eliminar usuario (cambiar el ID según necesites)
GET {{baseUrl}}/users/
Authorization: Bearer {{accessToken}}


### ============================================
### CATEGORÍAS
### ============================================

### 9. Obtener categorías
GET {{baseUrl}}/categorias/
Authorization: Bearer {{accessToken}}

### 10. Crear categoría
POST {{baseUrl}}/categorias/crear/
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "nombre": "Nueva Categoría",
  "descripcion": "Descripción de la categoría"
}

### 11. Actualizar categoría
PUT {{baseUrl}}/categorias/actualizar/1/
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "nombre": "Categoría Actualizada",
  "descripcion": "Nueva descripción"
}

### 12. Eliminar categoría
DELETE {{baseUrl}}/categorias/eliminar/1/
Authorization: Bearer {{accessToken}}


### ============================================
### PRODUCTOS
### ============================================

### 13. Obtener todos los productos
GET {{baseUrl}}/productos/
Authorization: Bearer {{accessToken}}

### 14. Crear producto
POST {{baseUrl}}/productos/crear/
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "nombre": "Producto Test",
  "descripcion": "Descripción del producto",
  "precio": 99.99,
  "precio_mayorista": 79.99,
  "categoria_id": 1,
  "genero": "unisex"
}


### ============================================
### EJEMPLOS CON DIFERENTES CREDENCIALES
### ============================================

### Login con usuario normal
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "username": "usuario",
  "password": "password123"
}

### Login con admin
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}


### ============================================
### PRUEBAS DE ERRORES
### ============================================

### Token inválido
GET {{baseUrl}}/users/
Authorization: Bearer token_invalido_para_probar

### Sin token (debe dar error 401)
GET {{baseUrl}}/users/

### Credenciales incorrectas
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "username": "usuario_inexistente",
  "password": "password_incorrecta"
}

### Usuario sin permisos intentando acceder a ruta de admin
# Primero haz login con un usuario normal, luego intenta acceder
GET {{baseUrl}}/users/
Authorization: Bearer {{accessToken}}


### ============================================
### NOTAS
### ============================================
# 
# 1. Ejecuta primero el request de Login (Ctrl+Alt+R o click en "Send Request")
# 2. Las variables @accessToken y @refreshToken se guardan automáticamente
# 3. Los demás requests usan automáticamente el token guardado
# 4. Si el token expira (después de 1 hora), ejecuta el request de "Renovar Access Token"
# 5. Para cambiar de usuario, ejecuta un nuevo Login
#
# ATAJOS DE TECLADO EN VS CODE:
# - Ctrl+Alt+R: Enviar request
# - Ctrl+Alt+C: Cancelar request
# - Ctrl+Alt+E: Cambiar entorno
#
### ============================================
